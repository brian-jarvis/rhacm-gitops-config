---
apiVersion: policy.open-cluster-management.io/v1
kind: Policy
metadata:
  name: ldap-ca
spec:
  disabled: false
  policy-templates:
    - objectDefinition:
        apiVersion: policy.open-cluster-management.io/v1
        kind: ConfigurationPolicy
        metadata:
          name: ldap-ca
        spec:
          namespaceSelector:
            exclude:
              - kube-*
            include:
              - default
          object-templates:
            - complianceType: musthave
              objectDefinition:
                apiVersion: v1
                kind: Namespace
                metadata:
                  labels:
                    app: ldap-infra
                  name: ldap-infra
            - complianceType: musthave
              objectDefinition:
                apiVersion: v1
                kind: ConfigMap
                metadata:
                  name: acm-ldap-ca-config
                  namespace: openshift-config
                data:
                  ca.crt: |
                    Test crt
                    
            # {{hub fromConfigMap "wookie-policies" "ldap-ca-config" "ca.crt" hub}}
            # - complianceType: musthave
            #   objectDefinition:
            #     apiVersion: config.openshift.io/v1
            #     kind: OAuth
            #     metadata:
            #       name: cluster
            #     spec:
            #       identityProviders:
            #         - ldap:
            #             attributes:
            #               email:
            #                 - mail
            #               id:
            #                 - sAMAccountName
            #               name:
            #                 - cn
            #               preferredUsername:
            #                 - sAMAccountName
            #             bindDN: svocpbind
            #             bindPassword:
            #               name: ldap-secret
            #             insecure: true
            #             url: ldap://ldapgc.smbcgroup.com:3268/DC=smbcgroup,DC=com?sAMAccountName
            #           mappingMethod: claim
            #           name: SMBC_ActiveDirectory
            #           type: LDAP
            #         - htpasswd:
            #             fileData:
            #               name: smbc-local-users
            #           mappingMethod: claim
            #           name: Emergency_BreakGlass
            #           type: HTPasswd
            #       templates:
            #         providerSelection:
            #           name: providers-template
            # - complianceType: musthave
            #   objectDefinition:
            #     apiVersion: rbac.authorization.k8s.io/v1
            #     kind: ClusterRoleBinding
            #     metadata:
            #       annotations:
            #         rbac.authorization.kubernetes.io/autoupdate: 'false'
            #       name: self-provisioners
            #     roleRef:
            #       apiGroup: rbac.authorization.k8s.io
            #       kind: ClusterRole
            #       name: self-provisioner
          remediationAction: enforce
          severity: low
  remediationAction: enforce